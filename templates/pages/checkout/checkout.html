{% extends 'index.html' %}
{% load static tailwind_tags %}
{% block content %}
{% tailwind_css %}
  <section id="checkout" class="container mt-[60px] py-[100px] h-full relative ">
    <div class="content flex flex-col gap-10 bg-opaque-black mx-[300px] px-8 py-16">
      <a href="/cart" class="mr-auto rounded-lg border border-electric-pink px-10 py-4 capitalize">
        <i class="fa-solid fa-arrow-left"></i> back to cart
      </a>
      <div class="flex gap-10">

        <!-- ORDER SUMMARY SECTION -->

        <div class="order-summary flex flex-col border border-gray-400">
          <h1 class="text-2xl font-bold mx-5 my-4">
            <hr>
            <p class="capitalize px-5 py-5">order summary</p>
            <hr>
          </h1>
          <div class="items flex flex-col pt-4 ">
            {% for item in items %}
              <div class="item flex border items-center mb-3 justify-between pr-10 border-gray-500">
                <div class="item-detail flex items-center w-[500px] pr-[50px] bg-gradient-to-r from-gray-500 to-transparent">
                  <img src="{{item.photocard.imageURL}}" alt="photocard" width="1000" height="1000" class="photocard-image w-[100px] h-[100px] object-cover mr-5" />
                  <div class="text-details flex flex-col py-2 mb-auto ">
                    <h1 class="font-semibold truncate w-[200px]">{{item.photocard.name}}</h1>
                    <p class="text-sm truncate w-[200px]">{{item.photocard.theme}}</p>
                    <p class="text-sm mt-2">{{item.quantity}}<span>x</span></p>
                  </div>
                  <p class="font-semibold text-xs ml-auto">
                    <i class="fa-solid fa-peso-sign"></i> 
                    <span class="text-base">{{item.get_total}}</span>
                  </p>
                </div>
              </div>
            {% endfor %}
          </div>

          <div class="cart-details mt-auto border p-8 pr-10 border-gray-400">
            <div class="total-photocards flex gap-2 ">
              <p class="capitalize w-[100px] text-right ">photocards:</p>
              <p class= text-xl font-semibold">{{order.get_items_total}}<span>x</span></span>
            </div>
            <div class="total-money flex gap-2 ">
              <p class="capitalize w-[100px] text-right ">total:</p>
              <p class="text-electric-pink text-sm">
                <i class="fa-solid fa-peso-sign"></i>
                <span class="text-xl font-semibold">{{order.get_cart_total}}</span>
              </p>
            </div>
          </div>
        </div>

        <!-- USER SECTION -->

        <div class="user border border-gray-400 ">
          <div id="shipping-info">
            <h1 class="text-2xl font-bold mx-5 my-4 ">
              <hr>
              <p class="capitalize px-5 py-5">shipping information</p>
              <hr>
            </h1>
            <form action="" id="user-form" class="flex flex-col px-4 pt-4 ">
              {% csrf_token %}
              <div id="user-info" class="grid grid-cols-2 gap-5 pb-10">
                <label for="name">
                  Name
                  <input type="username" name="name" id="name" placeholder="Name" required class="text-sm px-4 py-2 bg-transparent border border-gray-500 focus:outline-none">
                </label>
                <label for="email">
                  Email
                  <input type="email" name="email" id="email" placeholder="Email" required class="text-sm px-4 py-2 bg-transparent border border-gray-500 focus:outline-none">
                </label>
              </div>
              
              <div class="shipping-info grid grid-cols-2 gap-5">
                <label for="address" class="capitalize">
                  address
                  <input type="address" name="address" id="address" placeholder="Address" required class="text-sm px-4 py-2 bg-transparent border border-gray-500 focus:outline-none">
                </label>
                <label for="city" class="capitalize">
                  city
                  <input type="city" name="city" id="city" placeholder="City" required class="text-sm px-4 py-2 bg-transparent border border-gray-500 focus:outline-none">
                </label>
                <label for="zip-code" class="capitalize">
                  zip code
                  <input type="zip-code" name="zip-code" id="zip-code" placeholder="Zip Code" required class="text-sm px-4 py-2 bg-transparent border border-gray-500 focus:outline-none">
                </label>
              </div>
              <div id="continue-btn" class="p-8 pr-10 ml-auto ">
                <input type="submit" value="Continue" class="cursor-pointer rounded-lg bg-electric-pink px-10 py-4 capitalize ">
              </div>
            </form>
          </div>
          <div id="payment-info" class="hidden">
            <h1 class="text-2xl font-bold mx-5 my-4 ">
              <hr>
              <p class="capitalize px-5 py-5">payment information</p>
              <hr>
            </h1>
            <div class="payment-methods flex flex-col items-center gap-10 px-4 pt-4 ">
              <button type="radio" class="gcash focus:outline-electric-pink border-none w-full h-[80px] rounded-lg bg-white hover:bg-gray-200 flex items-center justify-center">
                <img src="{% static 'assets/images/gcash.png' %}" alt="" class="w-[100px]">
              </button>
              <button type="radio" class="paypal focus:outline-electric-pink border-none w-full h-[80px] rounded-lg bg-blue-700 hover:bg-blue-900 flex items-center justify-center">
                <div class="text-5xl text-white">
                  <i class="fa-brands fa-cc-paypal"></i>
                </div>
              </button>
              <button type="radio" class="cod focus:outline-electric-pink border-none w-full h-[80px] rounded-lg text-white bg-gray-700 hover:bg-gray-900 flex gap-4 items-center justify-center">
                <h1 class="capitalize">cash on delivery</h1>
                <div class="text-5xl">
                  <i class="fa-solid fa-truck-fast"></i>
                </div>
              </button>
              <div id="order" class="p-8 pr-10 ml-auto ">
                <input type="submit" value="order" class="cursor-pointer rounded-lg bg-electric-pink px-10 py-4 capitalize ">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script type="text/javascript">
    const form = document.querySelector('#user-form')
    csrftoken = form.getElementsByTagName('input')[0].value
    const total = '{{order.get_cart_total}}'

    if(user != 'AnonymousUser') document.querySelector('#user-info').textContent = ''

    const submitData = () => {
      console.log('Payed!')
      const userData = {
        'name': null,
        'email': null,
        'total': total,
      }
      const shippingData = {
        'address': null,
        'city': null,
        'zip-code': null,
      }

      if(user == 'AnonymousUser') {
        userData.name = form.name.value
        userData.email = form.email.value
      }

      const url = '/process_order'
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify({
          'user': userData,
          'shipping': shippingData,
        })
      })
      .then((response) => response.json())
      .then((data) => {
        console.log('Success: ', data)
        alert('Order Successful!')
        cart = {}
        document.cookie = 'cart=' + JSON.stringify(cart) + ";domain=;path=/"
        window.location.href = "{% url 'shop' %}"
      })
    }

    document.querySelector('#order').addEventListener('click', (event) => {
      submitData()
    })

    form.addEventListener('submit', (event) => {
      event.preventDefault()
      document.querySelector('#continue-btn').classList.add('hidden')
      document.querySelector('#payment-info').classList.remove('hidden')
    })
  </script>

  <!-- FOOTER -->

  <footer class="container border-t-[8px] border-electric-pink bg-opaque-black z-[70] relative bottom-0 w-full px-[15px] sm:px-[25px] md:px-[50px] lg:px-[75px] xl:px-[100px] 2xl:px-[150px] premium:px-[200px]">
    <div class="footer-full-content relative py-[50px] flex flex-col items-center gap-y-[80px]">
      <h1 class="brand flex items-center gap-x-[8px] text-[2rem] font-[700] capitalize sm:text-[2.5rem] sm:gap-x-[12px] lg:text-[3rem] xl:text-[3.5rem] premium:text-[4rem]">
        <img src="../../../static/assets/images/realpop-logo.png" alt="Realpop Logo" class="w-[60px] h-[60px] select-none sm:w-[70px] sm:h-[70px] lg:w-[80px] lg:h-[80px] xl:w-[90px] xl:h-[90px]" />
        Realpop
      </h1>
      <div class="content flex justify-between w-full">
        <div class="navigate flex flex-col gap-y-[16px]">
          <h2 class="text-[1.25rem] font-[700] capitalize sm:text-[1.5rem] lg:text-[1.8rem]">Navigate</h2>
          <div class="links flex flex-col gap-y-[8px]">
            <a href="/" class="footer-nav" >Home</a>
            <a href="/about" class="footer-nav" >About</a>
            <a href="/shop" class="footer-nav" >Shop</a>
            <a href="/contact" class="footer-nav" >Contact</a>
            <a href="/help" class="footer-nav" >Help</a>
          </div>
        </div>
        <div class="follow-us flex flex-col gap-y-[16px]">
          <h2 class="text-[1.25rem] font-[700] capitalize sm:text-[1.5rem] lg:text-[1.8rem]">Follow Us</h2>
          <div class="socmeds ">
            <div class="chris-section flex flex-col gap-y-[8px] pb-2">
              <p class="cursor-pointer font-semibold">Chris</p>
              <hr />
              <a href="https://www.facebook.com/chrsdrl" target="_blank" class="socmed flex items-center gap-x-[8px]">
                <div class=""><i class="fa-brands fa-facebook"></i></div>
                <p>chrsdrl</p>
              </a>
              <a href="https://www.instagram.com/lakezeus_/" target="_blank" class="socmed flex items-center gap-x-[8px]">
                <div class=""><i class="fa-brands fa-instagram"></i></div>
                <p>lakezeus_</p>
              </a>
              <a href="https://github.com/zyozyoo" target="_blank" class="socmed flex items-center gap-x-[8px]">
                <div class=""><i class="fa-brands fa-github"></i></div>
                <p>zyozyoo</p>
              </a>
            </div>
            <div class="jam-section flex flex-col gap-y-[8px] pb-2">
              <p class="cursor-pointer font-semibold">Moonbami</p>
              <hr />
              <a href="https://www.facebook.com/MoonbamiOffcl" target="_blank" class="socmed flex items-center gap-x-[8px]">
                <div class=""><i class="fa-brands fa-facebook"></i></div>
                <p>MoonbamiOffcl</p>
              </a>
              <a href="https://www.instagram.com/moonbamidesu/" target="_blank" class="socmed flex items-center gap-x-[8px]">
                <div class=""><i class="fa-brands fa-instagram"></i></div>
                <p>moonbamidesu</p>
              </a>
              <a href="https://github.com/MoonbamiOfficial" target="_blank" class="socmed flex items-center gap-x-[8px]">
                <div class=""><i class="fa-brands fa-github"></i></div>
                <p>MoonbamiOfficial</p>
              </a>
            </div>
          </div>
        </div>
        <div class="navigate flex flex-col gap-y-[16px]">
          <h2 class="text-[1.25rem] font-[700] capitalize sm:text-[1.5rem] lg:text-[1.8rem]">Photocards</h2>
          <div class="links flex flex-col gap-y-[8px] list-none">
            <li>TWICE</li>
            <li>NMIXX</li>
            <li>NewJeans</li>
            <li>aespa</li>
            <li>LE SSERAFIM</li>
          </div>
        </div>
      </div>
      <div class="copyright w-full text-center">
        <hr class=""/>
        <p class=" my-4 uppercase">&copy; <span class="footer-date"></span> Realpop from moonbami & jively</p>
      </div>
    </div>
  </footer>
{% endblock content %}
